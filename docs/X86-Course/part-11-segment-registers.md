## Part 11: Segment Registers

رجیسترهای بخش (Segment Registers) به‌طور خاص برای ارجاع به مکان‌های حافظه استفاده می‌شوند. سه روش مختلف برای دسترسی به حافظه سیستم وجود دارد که ما روی مدل حافظه‌ی مسطح (flat memory model) تمرکز می‌کنیم، زیرا برای مقاصد ما مرتبط است.

شش رجیستر بخش وجود دارد که به شرح زیر هستند:

1. **CS**: رجیستر بخش کد (Code Segment Register) که مکان پایه بخش کد (.text section) را ذخیره می‌کند و برای دسترسی به داده‌ها استفاده می‌شود.

2. **DS**: رجیستر بخش داده (Data Segment Register) که مکان پیش‌فرض برای متغیرها (.data section) را ذخیره می‌کند و برای دسترسی به داده‌ها به‌کار می‌رود.

3. **ES**: رجیستر بخش اضافی (Extra Segment Register) که در عملیات رشته‌ای (string operations) استفاده می‌شود.

4. **SS**: رجیستر بخش پشته (Stack Segment Register) که مکان پایه بخش پشته را ذخیره می‌کند و زمانی که به‌طور ضمنی از اشاره‌گر پشته (stack pointer) یا به‌طور صریح از اشاره‌گر پایه (base pointer) استفاده می‌شود، مورد استفاده قرار می‌گیرد.

5. **FS**: رجیستر بخش اضافی (Extra Segment Register).

6. **GS**: رجیستر بخش اضافی (Extra Segment Register).

هر رجیستر بخش ۱۶ بیت است و نشان‌دهنده‌ی اشاره‌گری به شروع بخش خاص حافظه است. رجیستر CS اشاره‌گر به بخش کد در حافظه را نگه می‌دارد. بخش کد جایی است که کدهای دستور (instruction codes) در حافظه ذخیره می‌شوند. پردازنده کدهای دستور را بر اساس مقدار رجیستر CS و یک مقدار آفست (offset) موجود در رجیستر اشاره‌گر دستور (EIP) از حافظه بازیابی می‌کند. توجه داشته باشید که هیچ برنامه‌ای نمی‌تواند به‌طور صریح رجیستر CS را بارگذاری یا تغییر دهد. پردازنده مقادیر آن را به محض اختصاص فضای حافظه به برنامه، تعیین می‌کند.

رجیسترهای DS، ES، FS و GS همگی برای اشاره به بخش‌های داده استفاده می‌شوند. هر یک از چهار بخش داده جداگانه به برنامه کمک می‌کند تا عناصر داده را تفکیک کند و اطمینان حاصل کند که آنها با هم تداخل نکنند. برنامه مقدار اشاره‌گر مناسب برای بخش‌ها را به رجیسترهای بخش داده بارگذاری می‌کند و سپس از یک مقدار آفست برای ارجاع به مکان‌های خاص حافظه استفاده می‌کند.

رجیستر بخش پشته (SS) برای اشاره به بخش پشته استفاده می‌شود. پشته شامل مقادیر داده‌ای است که به توابع و رویه‌های درون برنامه منتقل می‌شود.

رجیسترهای بخش بخشی از سیستم‌عامل به حساب می‌آیند و در تقریباً تمام موارد نمی‌توانند به‌طور مستقیم خوانده یا تغییر داده شوند. هنگام کار در حالت محافظت‌شده (protected mode) و مدل مسطح (flat model) (معماری x86 که ۳۲ بیت است)، برنامه شما اجرا می‌شود و یک فضای آدرس ۴ گیگابایتی دریافت می‌کند که هر رجیستر ۳۲ بیتی می‌تواند به هر یک از چهار میلیارد مکان حافظه اشاره کند، به جز آن مناطق محافظت‌شده که توسط سیستم‌عامل تعریف شده‌اند. حافظه فیزیکی ممکن است بزرگ‌تر از ۴ گیگابایت باشد، اما یک رجیستر ۳۲ بیتی فقط می‌تواند ۴،۲۹۴،۹۶۷،۲۹۶ مکان مختلف را بیان کند. اگر بیشتر از ۴ گیگابایت حافظه در کامپیوتر شما وجود داشته باشد، سیستم‌عامل باید یک ناحیه ۴ گیگابایتی در حافظه ترتیب دهد و برنامه‌های شما محدود به آن ناحیه جدید هستند. این کار توسط رجیسترهای بخش انجام می‌شود و سیستم‌عامل کنترل دقیقی بر روی آن دارد.

در درس بعدی، به بحث در مورد رجیستر اشاره‌گر دستور (Instruction Pointer Register) ادامه خواهیم داد.