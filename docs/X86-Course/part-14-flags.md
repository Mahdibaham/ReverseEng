## Part 14: Flags

پرچم‌ها (flags) یکی از پیچیده‌ترین مفاهیم در زبان اسمبلی و کنترل جریان برنامه در مهندسی معکوس هستند. این مطلب در مراحل پایانی آموزش، وقتی برنامه‌های C را به اسمبلی تبدیل می‌کنیم، واضح‌تر خواهد شد.

نکته مهم این است که پرچم‌ها به ما کمک می‌کنند تا اجرای برنامه را کنترل و بررسی کنیم و مکانیزمی برای تعیین موفقیت یا شکست هر عملیاتی که توسط پردازنده انجام می‌شود، ارائه می‌دهند.

پرچم‌ها در برنامه‌های اسمبلی حیاتی هستند، زیرا به‌عنوان ابزاری برای اطمینان از موفقیت‌آمیز بودن عملکردهای مختلف برنامه عمل می‌کنند.

در اسمبلی ۳۲ بیتی، یک رجیستر ۳۲ بیتی وجود دارد که مجموعه‌ای از پرچم‌های وضعیت، کنترل و سیستمی را در خود دارد. این رجیستر "EFLAGS" نام دارد و حاوی ۳۲ بیت اطلاعات است که هر بیت به یک پرچم خاص مرتبط است.

سه نوع پرچم داریم: 
1. پرچم‌های وضعیت
2. پرچم‌های کنترل
3. پرچم‌های سیستمی

### پرچم‌های وضعیت:
- __CF__: پرچم حمل (Carry Flag)
- __PF__: پرچم زوجیت (Parity Flag)
- __AF__: پرچم تنظیم (Adjust Flag)
- __ZF__: پرچم صفر (Zero Flag)
- __SF__: پرچم علامت (Sign Flag)
- __OF__: پرچم سرریز (Overflow Flag)

- **پرچم حمل (CF)**: وقتی یک عملیات ریاضی روی اعداد بدون علامت باعث ایجاد حمل یا قرض از بیت مهم‌ترین (بیشترین مقدار) شود، تنظیم می‌شود. این حالت به معنای سرریز رجیستر است و داده‌های باقی‌مانده دیگر درست نیستند.

- **پرچم زوجیت (PF)**: نشان‌دهنده فساد داده‌ها در نتیجه یک عملیات ریاضی است. اگر تعداد بیت‌های ۱ در نتیجه عملیات زوج باشد، پرچم تنظیم می‌شود؛ در غیر این صورت پاک می‌شود.

- **پرچم تنظیم (AF)**: در عملیات ریاضی کدگذاری دوتایی استفاده می‌شود و در صورت وقوع حمل یا قرض از بیت ۳ رجیستر، تنظیم می‌شود.

- **پرچم صفر (ZF)**: اگر نتیجه یک عملیات صفر شود، تنظیم می‌شود.

- **پرچم علامت (SF)**: نشان‌دهنده علامت نتیجه (مثبت یا منفی) است و به بیت مهم‌ترین نتیجه اختصاص می‌یابد.

- **پرچم سرریز (OF)**: در عملیات ریاضی با اعداد علامت‌دار استفاده می‌شود. اگر مقدار مثبت خیلی بزرگ یا مقدار منفی خیلی کوچک باشد که در رجیستر جای نگیرد، تنظیم می‌شود.

### پرچم‌های کنترل:
این پرچم‌ها برای کنترل رفتارهای خاص پردازنده استفاده می‌شوند.

- **پرچم جهت (DF)**: این پرچم نحوه پردازش رشته‌ها را کنترل می‌کند. اگر تنظیم شود، آدرس‌های حافظه به صورت کاهشی برای دریافت بایت بعدی در رشته استفاده می‌شوند. اگر پاک شود، آدرس‌ها افزایشی خواهند بود.

### پرچم‌های سیستمی:
این پرچم‌ها برای کنترل عملیات سطح سیستم عامل استفاده می‌شوند و نباید توسط برنامه‌ها تغییر یابند.

- **پرچم تله (TF)**: برای فعال کردن حالت اجرای تک‌مرحله‌ای استفاده می‌شود، که پردازنده فقط یک دستور را اجرا می‌کند و منتظر سیگنال برای دستور بعدی می‌ماند. این ویژگی در دیباگ کردن ضروری است.

- **پرچم فعال‌سازی وقفه (IF)**: نحوه واکنش پردازنده به سیگنال‌های خارجی را کنترل می‌کند.

- **پرچم سطح امتیاز ورودی/خروجی (IOPL)**: سطح دسترسی به آدرس‌های ورودی/خروجی را تعیین می‌کند.

- **پرچم وظیفه تودرتو (NT)**: نشان می‌دهد که وظیفه فعلی به وظیفه قبلی مرتبط است.

- **پرچم ادامه (RF)**: نحوه واکنش پردازنده به استثناها در حالت دیباگ را کنترل می‌کند.

- **پرچم حالت مجازی ۸۰۸۶ (VM)**: نشان می‌دهد که پردازنده در حالت مجازی ۸۰۸۶ کار می‌کند.

- **پرچم بررسی هم‌ترازی (AC)**: برای بررسی هم‌ترازی حافظه استفاده می‌شود.

- **پرچم وقفه مجازی (VIF)**: نسخه مجازی پرچم IF است در حالت مجازی.

- **پرچم وقفه در انتظار مجازی (VIP)**: نشان می‌دهد که یک وقفه در حالت مجازی در انتظار است.

- **پرچم شناسایی (ID)**: نشان می‌دهد که پردازنده از دستور CPUID پشتیبانی می‌کند.

در آموزش بعدی در مورد پشته صحبت خواهیم کرد.